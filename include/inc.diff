Only in dce: ALPHA
Only in dce: AT386
Only in dce: HP800
diff -rcw old_dce/Makefile.am dce/Makefile.am
*** old_dce/Makefile.am	Sun Aug  6 21:52:38 2000
--- dce/Makefile.am	Thu Aug 10 21:22:31 2000
***************
*** 1,17 ****
  ## Process this file with automake to produce Makefile.in
  include $(top_srcdir)/include.mk
  
! EXTRA_HEADERS=codesets.h codesets_stub.h conv.h \
!  convc.h ep.h idl_es.h idlbase.h idlddefs.h \
!  iovector.h lbase.h mgmt.h nbase.h ncastat.h \
!  ndrold.h nsattrid.h rpc.h rpcbase.h rpcexc.h \
!  rpcpvt.h rpcsts.h rpctypes.h stubbase.h twr.h \
!  uuid.h
! 
! CLEANFILES=$(EXTRA_HEADERS)
!  
! all-local:
! 	list='$(EXTRA_HEADERS)'; for include in $$list; do \
! 		ln -sf $(srcdir)/$$include $$include; \
  		done;
  	
--- 1,34 ----
  ## Process this file with automake to produce Makefile.in
  include $(top_srcdir)/include.mk
  
! commonidl= codesets.idl conv.idl convc.idl ep.idl \
! 		iovector.idl lbase.idl mgmt.idl nbase.idl ncastat.idl \
! 		ndrold.idl rpc.idl rpcbase.idl rpcpvt.idl rpcsts.idl rpctypes.idl \
! 		twr.idl uuid.idl
! 
! commonheaders=codesets_stub.h stubbase.h idl_es.h idlbase.h idlddefs.h \
! 	rpcexc.h
! 
! osdepheaders=dce_utils.h sec_authn.h dce.h dce_error.h
! cpudepheaders=marshall.h ndr_rep.h ndrtypes.h
! 
! IDLHEADERS=$(commonidl:.idl=.h)
! OSDEPHEADERS=$(osdepheaders:%=$(target_os)/%)
! CPUDEPHEADERS=$(cpudepheaders:%=$(target_cpu)/%)
! 
! EXTRA_HEADERS=$(IDLHEADERS) $(OSDEPHEADERS) $(CPUDEPHEADERS)
! 
! CLEANFILES=$(IDLHEADERS) $(osdepheaders) $(cpudepheaders)
! 
! .PHONY: do-header-symlinks
! 
! all-local: do-header-symlinks $(IDLHEADERS)
! 
! do-header-symlinks:
! 	list='$(osdepheaders)'; for include in $$list; do \
! 		ln -sf $(srcdir)/$(target_os)/$$include $(srcdir)/$$include; \
! 		done;
! 	list='$(cpudepheaders)'; for include in $$list; do \
! 		ln -sf $(srcdir)/$(target_cpu)/$$include $(srcdir)/$$include; \
  		done;
  
diff -rcw old_dce/Makefile.in dce/Makefile.in
*** old_dce/Makefile.in	Wed Aug  2 23:55:29 2000
--- dce/Makefile.in	Thu Aug 10 21:26:44 2000
***************
*** 84,103 ****
  target_cpu = @target_cpu@
  target_os = @target_os@
  
! dce_includes = -I$(top_builddir)/include 
! exception_includes = -I$(top_srcdir)/exceptions
  
! INCLUDES =  $(dce_includes) $(exception_includes)
  
  SUFFIXES = .idl
  
! IDL = $(top_builddir)/rpc/idl/idl_compiler/idl
! IDLFLAGS = -cepv -client none -server none $(dce_includes)
  
! EXTRA_HEADERS = codesets.h codesets_stub.h conv.h  convc.h ep.h idl_es.h idlbase.h idlddefs.h  iovector.h lbase.h mgmt.h nbase.h ncastat.h  ndrold.h nsattrid.h rpc.h rpcbase.h rpcexc.h  rpcpvt.h rpcsts.h rpctypes.h stubbase.h twr.h  uuid.h
  
  
! CLEANFILES = $(EXTRA_HEADERS)
  mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
  CONFIG_CLEAN_FILES = 
  DIST_COMMON =  Makefile.am Makefile.in
--- 84,118 ----
  target_cpu = @target_cpu@
  target_os = @target_os@
  
! dce_includes = -I$(top_srcdir)/include
  
! CFLAGS = -g -Wall -W -O -pipe -Werror
! INCLUDES =  $(dce_includes)
  
  SUFFIXES = .idl
  
! IDL = $(top_builddir)/idl/idl
! IDL_INCLUDE_DIR = $(top_srcdir)/include/dce
  
! IDLFLAGS = -cepv -client none -server none -I$(IDL_INCLUDE_DIR)/..
! NCK_IDLFLAGS = -keep object -no_cpp -v -no_mepv -I$(IDL_INCLUDE_DIR)/.. -I$(top_srcdir)/include -I$(TARGET_OS)
  
+ commonidl = codesets.idl conv.idl convc.idl ep.idl 		iovector.idl lbase.idl mgmt.idl nbase.idl ncastat.idl 		ndrold.idl rpc.idl rpcbase.idl rpcpvt.idl rpcsts.idl rpctypes.idl 		twr.idl uuid.idl
  
! 
! commonheaders = codesets_stub.h stubbase.h idl_es.h idlbase.h idlddefs.h 	rpcexc.h
! 
! 
! osdepheaders = dce_utils.h sec_authn.h dce.h dce_error.h
! cpudepheaders = marshall.h ndr_rep.h ndrtypes.h
! 
! IDLHEADERS = $(commonidl:.idl=.h)
! OSDEPHEADERS = $(osdepheaders:%=$(target_os)/%)
! CPUDEPHEADERS = $(cpudepheaders:%=$(target_cpu)/%)
! 
! EXTRA_HEADERS = $(IDLHEADERS) $(OSDEPHEADERS) $(CPUDEPHEADERS)
! 
! CLEANFILES = $(IDLHEADERS) $(osdepheaders) $(cpudepheaders)
  mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
  CONFIG_CLEAN_FILES = 
  DIST_COMMON =  Makefile.am Makefile.in
***************
*** 232,243 ****
  mostlyclean distclean maintainer-clean
  
  
  %.h: %.idl
! 	$(IDL) $(IDLFLAGS) -no_mepv $<
  
! all-local:
! 	list='$(EXTRA_HEADERS)'; for include in $$list; do \
! 		ln -sf $(srcdir)/$$include $$include; \
  		done;
  
  # Tell versions [3.59,3.63) of GNU make to not export all variables.
--- 247,268 ----
  mostlyclean distclean maintainer-clean
  
  
+ # The return code of the IDL compiler is ignored so that we can "build" in the
+ # include directory on pass 1 (this creates osdep symlinks) and on pass 2
+ # (after the IDL compiler has been built) we can generate headers.
  %.h: %.idl
! 	-test -x $(IDL) && $(IDL) $(IDLFLAGS) -no_mepv $<
! 
! .PHONY: do-header-symlinks
! 
! all-local: do-header-symlinks $(IDLHEADERS)
  
! do-header-symlinks:
! 	list='$(osdepheaders)'; for include in $$list; do \
! 		ln -sf $(srcdir)/$(target_os)/$$include $(srcdir)/$$include; \
! 		done;
! 	list='$(cpudepheaders)'; for include in $$list; do \
! 		ln -sf $(srcdir)/$(target_cpu)/$$include $(srcdir)/$$include; \
  		done;
  
  # Tell versions [3.59,3.63) of GNU make to not export all variables.
Only in dce: POWERPC
Only in dce: SPARC
Only in dce: codesets.acf
Only in old_dce: codesets.h
Only in old_dce: conv.h
Only in old_dce: convc.h
Only in dce: ep.acf
Only in old_dce: ep.h
Only in dce: i386
Only in dce: i686
Only in old_dce: iovector.h
Only in old_dce: lbase.h
Only in dce: linux-gnu
Only in dce: mgmt.acf
Only in old_dce: mgmt.h
Only in dce: nbase.acf
Only in old_dce: nbase.h
Only in old_dce: ncastat.h
Only in old_dce: ndrold.h
Only in old_dce: nsattrid.h
Only in old_dce: rpc.h
Only in old_dce: rpcbase.h
Only in old_dce: rpcpvt.h
Only in old_dce: rpcsts.h
Only in old_dce: rpctypes.h
diff -rcw old_dce/stubbase.h dce/stubbase.h
*** old_dce/stubbase.h	Tue Aug  1 01:38:37 2000
--- dce/stubbase.h	Sun Aug  6 20:25:58 2000
***************
*** 151,162 ****
  #ifndef NCK
  
  #ifdef STUBS_USE_PTHREADS
! 
! #ifdef DOS_FILENAME_RESTRICTIONS
! #  include <dce/pthread_.h>
! #else
! #  include <dce/pthread_exc.h>
! #endif /* DOS_FILENAME_RESTRICTIONS */
  #else  
  #include <cma.h>
  #endif /* STUBS_USE_PTHREADS */
--- 151,157 ----
  #ifndef NCK
  
  #ifdef STUBS_USE_PTHREADS
! # include <dce/exc_handling.h>
  #else  
  # include <cma.h>
  #endif /* STUBS_USE_PTHREADS */
***************
*** 641,656 ****
  
  #define RPC_SS_THREADS_ONCE_T pthread_once_t
  
! #define RPC_SS_THREADS_ONCE_INIT pthread_once_init
  
  #define RPC_SS_THREADS_ONCE(once_block_addr,init_routine) pthread_once( \
!     once_block_addr,(pthread_initroutine_t)init_routine)
  
  
  #define RPC_SS_THREADS_MUTEX_T pthread_mutex_t
  
  #define RPC_SS_THREADS_MUTEX_CREATE(mutex_addr) pthread_mutex_init( \
!     mutex_addr, pthread_mutexattr_default )
  
  #define RPC_SS_THREADS_MUTEX_LOCK(mutex_addr) pthread_mutex_lock(mutex_addr)
  
--- 636,651 ----
  
  #define RPC_SS_THREADS_ONCE_T pthread_once_t
  
! #define RPC_SS_THREADS_ONCE_INIT PTHREAD_ONCE_INIT
  
  #define RPC_SS_THREADS_ONCE(once_block_addr,init_routine) pthread_once( \
!     once_block_addr,init_routine)
  
  
  #define RPC_SS_THREADS_MUTEX_T pthread_mutex_t
  
  #define RPC_SS_THREADS_MUTEX_CREATE(mutex_addr) pthread_mutex_init( \
!     mutex_addr, NULL )
  
  #define RPC_SS_THREADS_MUTEX_LOCK(mutex_addr) pthread_mutex_lock(mutex_addr)
  
***************
*** 662,672 ****
  
  #define RPC_SS_THREADS_KEY_T pthread_key_t
  
! #define RPC_SS_THREADS_KEY_CREATE(key_addr,destructor) pthread_keycreate( \
      key_addr,destructor)
  
  #define RPC_SS_THREADS_KEY_SET_CONTEXT(key,value) pthread_setspecific( \
!     key,(pthread_addr_t)(value))
  
  	/* the pthd4 way
  #define RPC_SS_THREADS_KEY_GET_CONTEXT(key,value_addr) pthread_getspecific( \
--- 657,667 ----
  
  #define RPC_SS_THREADS_KEY_T pthread_key_t
  
! #define RPC_SS_THREADS_KEY_CREATE(key_addr,destructor) pthread_key_create( \
      key_addr,destructor)
  
  #define RPC_SS_THREADS_KEY_SET_CONTEXT(key,value) pthread_setspecific( \
!     key,(const void *)(value))
  
  	/* the pthd4 way
  #define RPC_SS_THREADS_KEY_GET_CONTEXT(key,value_addr) pthread_getspecific( \
***************
*** 678,684 ****
  #define RPC_SS_THREADS_CONDITION_T pthread_cond_t
  
  #define RPC_SS_THREADS_CONDITION_CREATE(condition_addr) pthread_cond_init( \
!     condition_addr,pthread_condattr_default)
  
  #define RPC_SS_THREADS_CONDITION_SIGNAL(condition_addr) pthread_cond_signal( \
      condition_addr)
--- 673,679 ----
  #define RPC_SS_THREADS_CONDITION_T pthread_cond_t
  
  #define RPC_SS_THREADS_CONDITION_CREATE(condition_addr) pthread_cond_init( \
!     condition_addr,NULL)
  
  #define RPC_SS_THREADS_CONDITION_SIGNAL(condition_addr) pthread_cond_signal( \
      condition_addr)
***************
*** 697,703 ****
  #define RPC_SS_THREADS_DISABLE_ASYNC(state) state=pthread_setasynccancel(CANCEL_OFF)
  */
  #define RPC_SS_THREADS_DISABLE_ASYNC(state) pthread_setcancelstate( \
! 		PTHREAD_CANCEL_DISABLE, &(state))
  
  /*
   * #define RPC_SS_THREADS_RESTORE_ASYNC(state) pthread_setasynccancel(state)
--- 692,698 ----
  #define RPC_SS_THREADS_DISABLE_ASYNC(state) state=pthread_setasynccancel(CANCEL_OFF)
  */
  #define RPC_SS_THREADS_DISABLE_ASYNC(state) pthread_setcancelstate( \
! 		PTHREAD_CANCEL_DISABLE, (int*)&(state))
  
  /*
   * #define RPC_SS_THREADS_RESTORE_ASYNC(state) pthread_setasynccancel(state)
***************
*** 708,714 ****
   * #define RPC_SS_THREADS_ENABLE_GENERAL(state) state=pthread_setcancel(CANCEL_ON)
   */
  #define RPC_SS_THREADS_ENABLE_GENERAL(state) pthread_setcancelstate( \
! 		PTHREAD_CANCEL_ENABLE, &(state))
  
  /*
   * #define RPC_SS_THREADS_RESTORE_GENERAL(state) state=pthread_setcancel(state)
--- 703,709 ----
   * #define RPC_SS_THREADS_ENABLE_GENERAL(state) state=pthread_setcancel(CANCEL_ON)
   */
  #define RPC_SS_THREADS_ENABLE_GENERAL(state) pthread_setcancelstate( \
! 		PTHREAD_CANCEL_ENABLE, (int*)&(state))
  
  /*
   * #define RPC_SS_THREADS_RESTORE_GENERAL(state) state=pthread_setcancel(state)
Only in old_dce: twr.h
Only in old_dce: uuid.h
